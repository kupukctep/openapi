buildscript {
    ext {
        springBootVersion = '2.6.5'
        javaxAnnotationApiVersion = '1.3.2'
    }
}

plugins {
    id "io.spring.dependency-management" version "1.0.11.RELEASE"
    id "java"
    id "org.openapi.generator" version "5.3.0"
    id "idea"
}

repositories {
    mavenCentral()
}

dependencies {
    implementation "org.springframework.boot:spring-boot-starter-web:$springBootVersion"
    implementation "javax.annotation:javax.annotation-api:$javaxAnnotationApiVersion"
    implementation "com.fasterxml.jackson.core:jackson-databind:2.9.9"
    implementation group: 'javax.validation', name: 'validation-api', version: '2.0.1.Final'
    implementation 'io.springfox:springfox-swagger2:2.9.2'
    implementation 'org.openapitools:jackson-databind-nullable:0.2.1'

}

//sourceSets {
//    generated{
//        java.srcDir "${buildDir}/generated/src/main/java"
//    }
//    main {
//        compileClasspath += generated.output
//        runtimeClasspath += generated.output
//    }
//
//    test {
//        compileClasspath += generated.output
//        runtimeClasspath += generated.output
//    }
//}
//
//openApiGenerate {
//    // other settings omitted
//    inputSpec = "${rootDir}/petstore.json"
//
//    outputDir = "${buildDir}/generated".toString()
//    apiPackage = "com.codeborne.api"
//    invokerPackage = "com.codeborne.invoker"
//    modelPackage = "com.codeborne.model"
//
//    generatorName = "spring"
//    globalProperties = [
//            modelDocs: "true",
////            models: "true",
////            apis: "true"
//
//    ]

//
//
//    configOptions = [
//            annotationLibrary:"none"
//    ]
//}
//
//jar.dependsOn tasks.openApiGenerate

//apply plugin: 'org.openapi.generator'

//sourceSets {
//    main {
//        java {
//            srcDir "$rootDir/api/src/main/java"
//        }
//    }
//}
// these dependencies are required for the generated code in order to build
ext {
    swagger_annotations_version = "1.5.22"
    jackson_version = "2.9.9"
    jackson_databind_version = "2.9.9"
    spring_web_version = "4.3.9.RELEASE"
    jodatime_version = "2.9.9"
    junit_version = "4.12"
    validation_version = "2.0.1.Final"
}

sourceSets {
    main {
        java {
            srcDir "$buildDir/generated/src/main/java"
        }
    }
}
//idea {
//    module {
//        // Marks the already(!) added srcDir as "generated"
//        generatedSourceDirs += "$buildDir/generated/src/main/java"
//    }
//}

openApiGenerate {
    globalProperties = [
            modelDocs: "false",
    ]
    generatorName = 'spring'
    validateSpec = true
    outputDir = "$buildDir/generated".toString()
    inputSpec = "${rootDir}/petstore.json"
    invokerPackage = 'com.demo.gradle'
    additionalProperties = [
            documentationProvider: "springdoc",
            oas3                   : "true",
            interfaceOnly       : "true",
            skipDefaultInterface: "true",
            useSwaggerUI        : "true"
    ]
    configOptions = [
            documentationProvider: "springdoc",
            oas3                   : 'true',
            interfaceOnly          : 'true',
            packageName            : 'com.demo.gradle',
            apiPackage             : 'com.demo.gradle.api',
            modelPackage           : 'com.demo.gradle.model',
            configPackage          : 'com.demo.gradle.configuration',
            hideGenerationTimestamp: 'true'
    ]
}

compileJava.dependsOn tasks.openApiGenerate

